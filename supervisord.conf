; ==============================================================================
; ElasticBot Backend - Supervisord Configuration
; ==============================================================================
; Runs web (Gunicorn), worker (Celery), and beat (Celery Beat) in one container
; ==============================================================================

[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
loglevel=info

[program:web]
command=bash -c "echo '======================================================' && echo 'üåê [WEB] STARTING GUNICORN SERVER...' && echo '======================================================' && gunicorn base.wsgi:application --bind 0.0.0.0:%(ENV_PORT)s --workers %(ENV_GUNICORN_WORKERS)s --timeout %(ENV_GUNICORN_TIMEOUT)s --access-logfile - --error-logfile -"
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=1
startsecs=5
stopwaitsecs=10

[program:worker]
command=bash -c "echo '======================================================' && echo '‚öôÔ∏è  [WORKER] STARTING CELERY WORKER...' && echo '======================================================' && celery -A base worker --loglevel=%(ENV_CELERY_LOG_LEVEL)s --concurrency=%(ENV_CELERY_CONCURRENCY)s"
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=2
startsecs=10
stopwaitsecs=30

[program:beat]
command=bash -c "echo '======================================================' && echo '‚è∞ [BEAT] STARTING CELERY BEAT SCHEDULER...' && echo 'Schedule: P2P scrape every 30 min (XX:00, XX:30)' && echo '======================================================' && celery -A base beat --loglevel=%(ENV_CELERY_LOG_LEVEL)s --scheduler django_celery_beat.schedulers:DatabaseScheduler"
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=3
startsecs=10
stopwaitsecs=30
